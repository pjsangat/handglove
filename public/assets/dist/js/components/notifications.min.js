var NOTIFICATIONS={init:function(){NOTIFICATIONS.events.fetch(),NOTIFICATIONS.events.markAllRead(),NOTIFICATIONS.events.markSingleRead(),setInterval(NOTIFICATIONS.events.fetch,6e4),$("#notification").on("show.bs.dropdown",function(){var t=$(this).next(".dropdown-menu"),i=$(this).offset().left;$(window).width()<i+t.outerWidth()?t.addClass("dropdown-menu-right"):t.removeClass("dropdown-menu-right")})},events:{fetch:function(){$.ajax({url:GLOBAL_BASE_URL+"notifications/get_unread",method:"POST",dataType:"json",success:function(t){"success"===t.status&&NOTIFICATIONS.build.list(t.notifications,t.count)},error:function(){console.log("Failed to fetch notifications")}})},markAllRead:function(){$("#mark-all-read").on("click",function(t){t.stopPropagation(),$.post(GLOBAL_BASE_URL+"notifications/mark_all_read",function(){NOTIFICATIONS.events.fetch()})})},markSingleRead:function(){$(document).on("click",".notification-item",function(){var t=$(this).data("id");t&&$.post(GLOBAL_BASE_URL+"notifications/mark_read/"+t)})}},build:{list:function(t,i){var n=$("#notification-count"),e=$("#notification-list");let o=GLOBAL_IMG_URL+"blank-img.png";if(0<i?n.text(i).css("display","flex"):n.hide(),0===t.length)e.html('<div class="p-4 text-center text-muted"><p class="mb-0">No new notifications</p></div>');else{let a="";t.forEach(t=>{var i=0==t.is_read?"unread":"",n=0==t.is_read?'<div class="unread-dot"></div>':"";a+=`
                    <a href="${t.url||"javascript:void(0)"}" class="notification-item d-flex align-items-center ${i}" data-id="${t.id}">
                        <div class="notification-avatar-container">
                            <img src="${o}" class="notification-avatar" alt="User">
                            <div class="notification-type-badge bg-primary">
                                <i class="fa ${NOTIFICATIONS.build.getIcon(t.type)}"></i>
                            </div>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${t.title}: ${t.message}</div>
                            <div class="notification-time">${NOTIFICATIONS.build.timeAgo(t.created_at)}</div>
                        </div>
                        ${n}
                    </a>`}),e.html(a)}},getIcon:function(t){switch(t){case"registration":return"fa-user-plus";case"approval":return"fa-check";case"shift":return"fa-calendar";default:return"fa-bell"}},timeAgo:function(t){var t=new Date(t),i=new Date,i=Math.floor((i-t)/1e3);return i<60?"Just now":1<=(t=Math.floor(i/3600))&&t<24?t+"h":24<=t?Math.floor(t/24)+"d":Math.floor(i/60)+"m"}}};$(document).ready(NOTIFICATIONS.init);